var Xebra=window.Xebra||{};(function scopeWrapper($3){var loginUrl="https://6a0olyfabe.execute-api.us-west-1.amazonaws.com/dev/a/login";var poolData={UserPoolId:_config.cognito.userPoolId,ClientId:_config.cognito.userPoolClientId};var userPool;if(!(_config.cognito.userPoolId&&_config.cognito.userPoolClientId&&_config.cognito.region)){$3("#noCognitoMessage").show();return}userPool=new AmazonCognitoIdentity.CognitoUserPool(poolData);if(typeof AWSCognito!=="undefined"){AWSCognito.config.region=_config.cognito.region}Xebra.signOut=function signOut(){userPool.getCurrentUser().signOut()};Xebra.authToken=new Promise(function fetchCurrentAuthToken(resolve,reject){var cognitoUser=userPool.getCurrentUser();if(cognitoUser){cognitoUser.getSession(function sessionCallback(err,session){if(err){reject(err)}else if(!session.isValid()){resolve(null)}else{resolve(session.getIdToken().getJwtToken())}})}else{resolve(null)}});function register(email,password,onSuccess,onFailure){var dataEmail={Name:"email",Value:email};var attributeEmail=new AmazonCognitoIdentity.CognitoUserAttribute(dataEmail);userPool.signUp(toUsername(email),password,[attributeEmail],null,function signUpCallback(err,result){if(!err){onSuccess(result)}else{onFailure(err)}})}function login(email,password,onSuccess,onFailure){var authenticationDetails=new AmazonCognitoIdentity.AuthenticationDetails({Username:email,Password:password});var cognitoUser=createCognitoUser(email);cognitoUser.authenticateUser(authenticationDetails,{onSuccess:onSuccess,onFailure:onFailure})}function verify(email,code,onSuccess,onFailure){createCognitoUser(email).confirmRegistration(code,true,function confirmCallback(err,result){if(!err){onSuccess(result)}else{onFailure(err)}})}function createCognitoUser(email){return new AmazonCognitoIdentity.CognitoUser({Username:email,Pool:userPool})}$(function onDocReady(){$3("#login-form").submit(handleLogin);$3("#verifyForm").submit(handleVerify)});function handleLogin(event){var email=$("#email-input-login").val();var password=$("#password-input-login").val();event.preventDefault();login(email,password,function loginSuccess(){console.log("Successfully Logged In");window.location.href="https://6a0olyfabe.execute-api.us-west-1.amazonaws.com/dev/a"},function loginError(err){alert(err)})}function handleRegister(event){var email=$3("#emailInputRegister").val();var password=$3("#passwordInputRegister").val();var password2=$3("#password2InputRegister").val();var onSuccess=function registerSuccess(result){var cognitoUser=result.user;console.log("user name is "+cognitoUser.getUsername());var confirmation="Registration successful. Please check your email inbox or spam folder for your verification code.";if(confirmation){window.location.href="verify.html"}};var onFailure=function registerFailure(err){alert(err)};event.preventDefault();if(password===password2){register(email,password,onSuccess,onFailure)}else{alert("Passwords do not match")}}function handleVerify(event){var email=$3("#emailInputVerify").val();var code=$3("#codeInputVerify").val();event.preventDefault();verify(email,code,function verifySuccess(result){console.log("call result: "+result);console.log("Successfully verified");alert("Verification successful. You will now be redirected to the login page.");window.location.href=loginUrl},function verifyError(err){alert(err)})}})(jQuery);